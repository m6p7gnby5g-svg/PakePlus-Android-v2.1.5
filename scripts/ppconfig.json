{"name":"ebbbedddbdcef","url":"https://app.yourmusic.fun/create","showName":"mini-K","appid":"com.ebbbedddbdcef.app","icon":"","iconPath":"C:\\Users\\Administrator\\AppData\\Roaming\\com.pakeplus.pacbao\\twt2976tuvs.png","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":true,"version":"1.0.1","preview":"desktop","platform":["1-1"],"width":600,"height":800,"desc":"","jsFile":[],"filterCss":"","customJs":"# -*- coding: utf-8 -*-\n\"\"\"\n时段管理自动化 V2 - 修复版\n核心修复：\n1. 时间选择使用坐标区分开始/结束选择器\n2. 保存按钮使用坐标点击\n\"\"\"\nimport time\nfrom playwright.sync_api import sync_playwright\n\nCOOKIES_STR = \"\"\"s_ViewType=10; WEBDFPID=5v9uxwv3050v565zzxvz40y7v7vv524080y0yv5wy4y97958yxy7vz11-1768110331408-1767847027766YKESWMU10f02007e9804b0b4cf483cebf1f9f513421; _lxsdk_cuid=19b9be4e4f6c8-0b3a51042db71a-8535026-1fa400-19b9be4e4f6c8; _lxsdk=19b9be4e4f6c8-0b3a51042db71a-8535026-1fa400-19b9be4e4f6c8; _hc.v=9dab3d56-ad66-d542-45a2-ae9d1e812714.1767847028; qruuid=8d09239d-dfa1-42b7-9db6-24af9bf5adf7; utm_source_rg=AM%25708xExE%25556; fspop=test; ctu=c5c61393c62557f539c833eb25c64f8fb26f333383acfbea33ffc5cfc98b8acd; PHOENIX_ID=0a63bfa7-19b9d5bc948-345314; bizType=2; edper=p3lTfeGkMKRdLOXR1olqOFYRDAcI-EtQpqfmYJm38WA3BsrclRKx8KGnuWkFr22PqChchyFlYZsYQhElkYvU0w; ecom_kdb_to_jyb_gray_flag=1; logan_session_token=ff5ljq8cz316r78sy3hw; mpmerchant_portal_shopid=1418925265; merchantBookShopID=1418925265; merchantCategoryID=2890\"\"\"\n\nTIMESLOTS = [\n    {'start': '12:00', 'end': '17:00'},\n    {'start': '12:00', 'end': '18:00'},\n    {'start': '12:00', 'end': '20:00'},\n    {'start': '16:00', 'end': '21:00'},\n    {'start': '18:00', 'end': '05:00', 'next_day': True},\n    {'start': '23:00', 'end': '05:00', 'next_day': True},\n]\n\ndef parse_cookies(s):\n    return [{'name': n, 'value': v, 'domain': '.dianping.com', 'path': '/'} \n            for item in s.split('; ') if '=' in item for n, v in [item.split('=', 1)]]\n\nprint(\"=\"*60)\nprint(\"时段管理自动化 V2\")\nprint(\"=\"*60)\n\npw = sync_playwright().start()\nbrowser = pw.chromium.launch(headless=False)\nctx = browser.new_context(viewport={'width': 1920, 'height': 1080})\nctx.add_cookies(parse_cookies(COOKIES_STR))\npage = ctx.new_page()\n\nprint(\"\\n[1] 访问页面...\")\npage.goto(\"https://e.dianping.com/sc/pc/merchant/book-meal-page\", wait_until='networkidle', timeout=60000)\ntime.sleep(2)\n\nprint(\"[2] 进入包房时段管理...\")\npage.locator('text=包房时段管理').first.click()\ntime.sleep(3)\n\niframe = page.frame_locator('iframe').first\nframe = page.frames[1] if len(page.frames) > 1 else page.main_frame\n\npage.evaluate(\"window.scrollTo(0, 1000)\")\ntime.sleep(1)\n\nprint(\"[3] 进入编辑模式...\")\niframe.locator('text=编辑时段库存').first.click()\ntime.sleep(2)\n\n# ==================== 删除所有时段 ====================\nprint(\"\\n[4] 删除所有时段...\")\ndeleted_count = 0\nfor _ in range(20):\n    # 找y坐标大于600的删除按钮（时段区域）\n    result = frame.evaluate('''() => {\n        let btns = document.querySelectorAll('button');\n        for (let btn of btns) {\n            let rect = btn.getBoundingClientRect();\n            if (btn.textContent.trim() === '删除' && rect.y > 600 && rect.y < 1200) {\n                btn.click();\n                return true;\n            }\n        }\n        return false;\n    }''')\n    if not result:\n        break\n    time.sleep(0.3)\n    # 点击确定\n    frame.evaluate('''() => {\n        let btns = document.querySelectorAll('button');\n        for (let btn of btns) {\n            if (btn.textContent.trim() === '确定') { btn.click(); break; }\n        }\n    }''')\n    time.sleep(0.3)\n    deleted_count += 1\n    print(f\"    删除第{deleted_count}个 ✓\")\n\nprint(f\"\\n    共删除 {deleted_count} 个时段\")\n\n# ==================== 添加时段 ====================\nprint(\"\\n[5] 录入新时段...\")\n\nfor i, ts in enumerate(TIMESLOTS):\n    start_h = ts['start'].split(':')[0]\n    end_h = ts['end'].split(':')[0]\n    is_next_day = ts.get('next_day', False)\n    \n    print(f\"\\n    [{i+1}] 添加 {ts['start']}-{ts['end']}\")\n    \n    # 1. 点击+添加时段\n    frame.evaluate('''() => {\n        let btns = document.querySelectorAll('button, span');\n        for (let el of btns) {\n            if (el.textContent.includes('+添加时段')) { el.click(); break; }\n        }\n    }''')\n    time.sleep(0.3)\n    \n    # 2. 点击开始时间输入框\n    frame.evaluate('''() => {\n        document.querySelector('input[placeholder=\"开始时间\"]').click();\n    }''')\n    time.sleep(0.2)\n    \n    # 3. 选择开始小时 - 只选择x坐标在650-750之间的（开始时间列）\n    frame.evaluate(f'''() => {{\n        let lis = document.querySelectorAll('li.common-list-item');\n        for (let li of lis) {{\n            let rect = li.getBoundingClientRect();\n            if (li.textContent.trim() === '{start_h}' && rect.x > 650 && rect.x < 750) {{\n                li.scrollIntoView({{block: 'center'}});\n                li.click();\n                return;\n            }}\n        }}\n    }}''')\n    time.sleep(0.2)\n    \n    # 4. 点击结束时间输入框\n    frame.evaluate('''() => {\n        document.querySelector('input[placeholder=\"结束时间\"]').click();\n    }''')\n    time.sleep(0.2)\n    \n    # 5. 如果是次日，点击次日\n    if is_next_day:\n        frame.evaluate('''() => {\n            let lis = document.querySelectorAll('li.common-list-item');\n            for (let li of lis) {\n                if (li.textContent.trim() === '次日') { li.click(); break; }\n            }\n        }''')\n        time.sleep(0.1)\n    \n    # 6. 选择结束小时 - 只选择x坐标在850-950之间的（结束时间列）\n    frame.evaluate(f'''() => {{\n        let lis = document.querySelectorAll('li.common-list-item');\n        for (let li of lis) {{\n            let rect = li.getBoundingClientRect();\n            if (li.textContent.trim() === '{end_h}' && rect.x > 850 && rect.x < 950) {{\n                li.scrollIntoView({{block: 'center'}});\n                li.click();\n                return;\n            }}\n        }}\n    }}''')\n    time.sleep(0.2)\n    \n    # 7. 点击弹窗内的保存按钮 - 使用坐标（y在550-600之间的保存按钮）\n    frame.evaluate('''() => {\n        let btns = document.querySelectorAll('button.mtd-btn-primary');\n        for (let btn of btns) {\n            let rect = btn.getBoundingClientRect();\n            if (btn.textContent.includes('保存') && rect.y > 500 && rect.y < 650) {\n                btn.click();\n                return;\n            }\n        }\n    }''')\n    time.sleep(0.5)\n    print(f\"        已保存 ✓\")\n\n# ==================== 复制到其他日期 ====================\nprint(\"\\n[6] 复制到其他日期...\")\n\nframe.evaluate('''() => {\n    let btns = document.querySelectorAll('button');\n    for (let btn of btns) {\n        if (btn.textContent.includes('复制到其他日期')) { btn.click(); break; }\n    }\n}''')\ntime.sleep(0.5)\n\n# 勾选周二~周日\nfor day in ['周二', '周三', '周四', '周五', '周六', '周日']:\n    frame.evaluate(f'''() => {{\n        let labels = document.querySelectorAll('label');\n        for (let label of labels) {{\n            if (label.textContent.includes('{day}')) {{ label.click(); break; }}\n        }}\n    }}''')\n    time.sleep(0.1)\n    print(f\"    勾选{day} ✓\")\n\n# 确定 - 先滚动使按钮可见，然后用键盘或点击\n# 方法1: 滚动iframe内容使确定按钮可见\nframe.evaluate('''() => {\n    let btn = null;\n    let btns = document.querySelectorAll('button.mtd-btn-primary');\n    for (let b of btns) {\n        if (b.textContent.trim() === '确定') { btn = b; break; }\n    }\n    if (btn) {\n        btn.scrollIntoView({block: 'center'});\n        setTimeout(() => btn.click(), 100);\n    }\n}''')\ntime.sleep(0.5)\n\n# 方法2: 用键盘Tab到确定按钮并按Enter\npage.keyboard.press('Tab')\ntime.sleep(0.1)\npage.keyboard.press('Enter')\ntime.sleep(0.5)\n\n# 检查弹窗是否关闭\nmodal_closed = frame.evaluate('''() => {\n    let modals = document.querySelectorAll('.mtd-modal-wrapper');\n    for (let m of modals) {\n        if (m.offsetWidth > 0 && m.textContent.includes('复制至其他日期')) return false;\n    }\n    return true;\n}''')\n\nif not modal_closed:\n    # 方法3: 直接坐标点击 - 根据截图确定按钮大约在(830, 350)相对于iframe\n    # iframe偏移约(0, 222)\n    page.mouse.click(830, 572)\n    print(\"    坐标点击确定按钮\")\n    time.sleep(0.5)\n\nprint(\"    复制完成 ✓\")\n\n# ==================== 保存时段库存 ====================\nprint(\"\\n[7] 保存时段库存...\")\nframe.evaluate('''() => {\n    let btns = document.querySelectorAll('button');\n    for (let btn of btns) {\n        if (btn.textContent.includes('保存时段库存')) { btn.click(); break; }\n    }\n}''')\ntime.sleep(2)\nprint(\"    保存成功! ✓\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"完成!\")\nprint(\"=\"*60)\n\npage.screenshot(path='timeslot_result.png')\nprint(\"截图: timeslot_result.png\")\n\nprint(\"\\n保持60秒查看结果...\")\ntime.sleep(60)\n\nbrowser.close()\npw.stop()\n","isHtml":false,"htmlPath":"","htmlFiles":[],"prefix":"","pcRepo":"PakePlus-v2.1.5","iosRepo":"PakePlus-iOS-v2.1.5","androidRepo":"PakePlus-Android-v2.1.5","more":{"windows":{"label":"","title":"mini-K","url":"https://app.yourmusic.fun/create","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36","width":600,"height":800,"theme":null,"resizable":true,"fullscreen":false,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":true,"alwaysOnBottom":false,"center":false,"shadow":true,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":false,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":true,"create":false,"backgroundColor":null,"backgroundThrottling":null,"javascriptDisabled":false}},"phone":{"fullScreen":false,"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"ebbbedddbdcef","showName":"mini-K","version":"1.0.1","webUrl":"https://app.yourmusic.fun/create","id":"com.ebbbedddbdcef.app.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":false,"safeArea":"top"},"android":{"name":"ebbbedddbdcef","showName":"mini-K","version":"1.0.1","webUrl":"https://app.yourmusic.fun/create","id":"com.ebbbedddbdcef.app.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":false,"safeArea":"top"},"desktop":{"name":"ebbbedddbdcef","showName":"mini-K","version":"1.0.1","id":"com.ebbbedddbdcef.app.desktop","desc":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","webUrl":"https://app.yourmusic.fun/create","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","isHtml":false,"single":true,"state":true,"injectJq":false,"tauriApi":false,"buildMethod":"local","debug":false}}